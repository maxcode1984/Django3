# Проект "Новостной портал" (News Portal)

Это учебный бэкенд-проект, разработанный на фреймворке Django. Проект эмулирует базовую архитектуру новостного сайта, включая модели авторов, постов, категорий и комментариев.

## Ключевые возможности

*   **Разделение контента:** Посты делятся на два типа — «статьи» и «новости».
*   **Рейтинговая система:** Пользователи могут оценивать посты и комментарии, на основе чего формируется рейтинг авторов.
*   **Категоризация:** Посты могут принадлежать к нескольким категориям одновременно.
*   **Система комментирования:** Зарегистрированные пользователи могут оставлять комментарии к постам.
*   **Инкапсулированная логика:** Вся логика по работе с рейтингами и отображению данных (`preview`) вынесена в методы моделей.

## Архитектура моделей (`news/models.py`)

Архитектура базы данных спроектирована с учетом нормализации и эффективности связей между сущностями.

### `Author`
Модель для хранения информации об авторах контента.

*   `user` (`OneToOneField` с `User`): Связь "один к одному". Это решение выбрано потому, что каждый автор в системе — это уникальный пользователь Django, но не каждый пользователь обязан быть автором. `OneToOneField` гарантирует эту уникальность и позволяет расширять стандартную модель `User`, не изменяя её.
*   `rating` (`IntegerField`): Рейтинг автора, который рассчитывается на основе оценок его контента.

### `Category`
Модель для категоризации постов.

*   `name` (`CharField` с `unique=True`): Название категории. Параметр `unique=True` обеспечивает, что в базе не будет дублирующихся категорий (например, двух категорий "Спорт").

### `Post`
Основная модель, представляющая статью или новость.

*   `author` (`ForeignKey` к `Author`): Связь "один ко многим". У одного автора может быть много постов, но у поста всегда только один автор.
*   `post_type` (`CharField` с `choices`): Позволяет выбрать тип контента.
*   `created_at` (`DateTimeField` с `auto_now_add=True`): Автоматически фиксирует время создания поста.
*   `categories` (`ManyToManyField` к `Category`): Связь "многие ко многим". Реализована через промежуточную модель `PostCategory`. Это позволяет одному посту принадлежать к нескольким категориям, а одной категории — содержать много постов.
*   `title`, `text`, `rating`: Заголовок, основной текст и рейтинг поста.

### `PostCategory`
Промежуточная модель для связи `Post` и `Category`.

*   `post` (`ForeignKey` к `Post`) и `category` (`ForeignKey` к `Category`): Два внешних ключа, которые вместе формируют связь "многие ко многим".

### `Comment`
Модель для хранения комментариев.

*   `post` (`ForeignKey` к `Post`): Указывает, к какому посту относится комментарий.
*   `user` (`ForeignKey` к `User`): Указывает, какой пользователь оставил комментарий.
*   `text`, `created_at`, `rating`: Содержимое, дата создания и рейтинг комментария.

## Реализованные методы моделей

### Методы `like()` / `dislike()`
Присутствуют в моделях `Post` и `Comment`. Это простые атомарные операции, которые инкрементируют или декрементируют поле `rating` на единицу и сохраняют объект. Это инкапсулирует логику изменения рейтинга внутри самой модели.

### Метод `preview()`
Присутствует в модели `Post`. Возвращает срез текста поста (первые 124 символа) с добавлением многоточия. Это удобно для формирования анонсов на страницах со списком новостей.

### Метод `update_rating()`
Ключевой метод модели `Author` для пересчета рейтинга. Логика расчета:
1.  Суммарный рейтинг каждой статьи автора умножается на 3.
2.  К этому прибавляется суммарный рейтинг всех комментариев самого автора.
3.  К этому прибавляется суммарный рейтинг всех комментариев ко всем статьям автора.

Для подсчета используются `aggregate(Sum(...))`, что позволяет выполнить вычисления на стороне базы данных — это гораздо эффективнее, чем выгружать все объекты в Python и считать в цикле.

## Инструкция по установке и запуску

1.  **Клонируйте репозиторий:**
    ```
    git clone https://github.com/[ВАШ_НИКНЕЙМ]/[НАЗВАНИЕ_РЕПОЗИТОРИЯ].git
    cd [НАЗВАНИЕ_РЕПОЗИТОРИЯ]
    ```

2.  **Создайте и активируйте виртуальное окружение:**
    ```
    # Создание
    python -m venv venv
    # Активация (Windows)
    venv\Scripts\activate
    # Активация (macOS/Linux)
    source venv/bin/activate
    ```

3.  **Установите зависимости:**
    ```
    pip install -r requirements.txt
    ```

4.  **Примените миграции:**
    Эта команда создаст все необходимые таблицы в базе данных `db.sqlite3` на основе описанных моделей.
    ```
    python manage.py migrate
    ```

5.  **Создайте суперпользователя** (для доступа к админ-панели):
    ```
    python manage.py createsuperuser
    ```

6.  **Запустите демонстрационный скрипт:**
    В проекте есть файл `shell_commands.py`, который выполняет все действия, требуемые в задании: создает пользователей, авторов, посты, комментарии, выставляет оценки и выводит итоговые данные. Для его запуска используйте Django Shell.
    
    Откройте shell:
    ```
    python manage.py shell
    ```
    
    Внутри shell выполните команду:
    ```
    exec(open('shell_commands.py', encoding='utf-8').read())
    ```
    В консоли отобразится результат работы скрипта, включая рейтинг лучшего автора и информацию о лучшей статье.

![img.png](img.png)